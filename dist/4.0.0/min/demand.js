/*! Qoopido.js 4.0.0, 2015-08-30 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(e){"use strict";function t(){var e,t,n=this||{},r=n instanceof p?n:null,a=w.call(arguments);return n.then=function(n,r){e=n,t=r},a.forEach(function(e,t){var n=m.path(e,r),a=n.handler,u=H[a]||(H[a]={});this[t]=u[n.path]||(u[n.path]=new f(e,r).promise)},a),Promise.all(a).then(function(){"function"==typeof e&&e.apply(null,arguments[0])},function(e){"function"==typeof t&&t(e)}),n}function n(){var e,t,n,r,a,u=arguments[0]&&"string"==typeof arguments[0]&&arguments[0]||null,o=!u&&arguments[0]||arguments[1];if(!u&&g.current&&(t=g.current,u=t.path),!u)throw new s("unspecified anonymous provide");return v(function(){n=new p(u,o,e||[]),r=H[n.handler][n.path]=n.promise,t&&(a=t.defered,r.then(function(e){a.resolve(e)},function(e){a.reject(new s("unable to resolve module",t.path,e))}),g.length>0&&g.next())},0),{when:function(){e=w.call(arguments)}}}function r(e){var t,n=e.base,r=e.pattern;if(n&&(R=new c(n,m.url(n).href)),r)for(t in r)A[t]=new c(t,r[t])}function a(e,t,n){return C[e]?!1:(C[e]={suffix:t,callback:n},H[e]={},!0)}function u(e){var t=e instanceof s?"error":"info";"undefined"!=typeof console&&console[t](e.toString())}function o(e){return e.replace(P,"\\$&")}function i(e){return j.test(e)}function s(e,t,n){var r=this;return r.message=e,r.module=t,n&&(r.stack=n),r}function c(e,t){var n=this;n.url=m.url(t).href,n.regexPattern=new RegExp("^"+o(e)),n.regexUrl=new RegExp("^"+o(t))}function l(){var e=this;e.queue=[],e.current=null}function f(e,t){var n,r=this,a=Promise.defer(),o=new XMLHttpRequest;return m.path.call(r,e,t),r.defered=a,r.promise=a.promise,n=C[r.handler],t||r.promise.then(null,u),n?(o.onreadystatechange=function(){4===o.readyState&&(200===o.status||0===o.status&&o.responseText?(r.value=o.responseText,g.add(r)):a.reject(new s("unable to load module",r.path)))},o.open("GET",r.url+n.suffix,!0),o.send(),setTimeout(function(){o.readyState<4&&o.abort()},5e3)):a.reject(new s('no handler "'+r.handler+'" for',r.path)),r}function p(e,n,r){var a=this,o=Promise.defer();return m.path.call(a,e),a.promise=o.promise,a.promise.then(null,function(e){u(new s("unable to resolve module",a.path,e))}),t.apply(a,r).then(function(){o.resolve(n.apply(null,arguments))},function(e){o.reject(new s("unable to resolve dependencies for",a.path,e))}),a}function h(e,t){var n=y.createElement("script");n.defer=n.async=!0,n.text=t,n.setAttribute("demand-path",e),b.appendChild(n)}function d(e){}var m,g,v=e.setTimeout,y=document,w=Array.prototype.slice,x={base:"/"},b=y.getElementsByTagName("head")[0],E=y.createElement("a"),j=/^\//i,q=/^([-\w]+\/[-\w]+)!/,P=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,T=e.demand.main,k=e.demand.settings,S=e.location.host,R={},A={},C={},H={};if(m={url:function(e){return E.href=e,E},path:function(e,t){var n,r,a,u=this,o=e.match(q)||"application/javascript";"string"!=typeof o&&(e=e.replace(o[0],""),o=o[1]),e=(n=i(e))?R.remove(m.url(R.url+e).href):m.url((t&&t.path+"/../"||"/")+e).pathname;for(r in A)A[r].matches(e)&&(a=A[r]);return u instanceof p||u instanceof f?(u.handler=o,u.path=e,u instanceof f&&(u.url=m.url(a?a.process(e):(n?"//"+S:R.url)+e).href),void 0):{handler:o,path:e}}},s.prototype={toString:function(){var e=this,t="[demand] "+e.message+" "+e.module;if(e.stack)for(;e=e.stack;)t+="\n    > "+e.message+" "+e.module;return t}},c.prototype={matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},l.prototype={length:0,add:function(e){var t=this,n=t.queue;n.push(e),t.length++,1===n.length&&t.next()},next:function(){var e=this,t=e.current,n=e.queue;t&&(e.current=null,n.shift(),e.length--),n.length&&(t=e.current=e.queue[0],C[t.handler].callback(t.path,t.value))}},g=new l,a("application/javascript",".js",h),a("text/css",".css",d),r(x)&&k&&r(k),t.configure=r,t.addHandler=a,e.demand=t,e.provide=n,T){var U=y.createElement("script");U.defer=U.async=!0,U.src=T,b.appendChild(U)}e.debug={modules:H,queue:g}}(this);