/*! Qoopido.js 4.0.0, 2015-08-28 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(e){"use strict";function t(){var e,t,n=this||{},r=n instanceof p?n:null,a=y.call(arguments);return n.then=function(n,r){e=n,t=r},a.forEach(function(e,t){var n=m.path(e,r),a=n.handler,u=C[a]||(C[a]={});this[t]=u[n.path]||(u[n.path]=new f(e,r).promise)},a),Promise.all(a).then(function(){"function"==typeof e&&e.apply(null,arguments[0])},function(e){"function"==typeof t&&t(e)}),n}function n(){var e,t,n,r,a=arguments[0]&&"string"==typeof arguments[0]&&arguments[0]||null,u=!a&&arguments[0]||arguments[1],o=y.call(arguments,a?2:1);if(!a&&g.current&&(e=g.current,a=e.path),!a)throw new i("unspecified anonymous provide");t=new p(a,u,o),n=C[t.handler][t.path]=t.promise,e&&(r=e.defered,n.then(function(e){r.resolve(e)},function(t){r.reject(new i("unable to resolve module",e.path,t))}),g.length>0&&g.next())}function r(e){var t,n=e.base,r=e.pattern;if(n&&(S=new l(n,m.url(n).href)),r)for(t in r)R[t]=new l(t,r[t])}function a(e,t,n){return A[e]?!1:(A[e]={suffix:t,callback:n},C[e]={},!0)}function u(e){var t=e instanceof i?"error":"info";"undefined"!=typeof console&&console[t](e.toString())}function o(e){return e.replace(q,"\\$&")}function s(e){return E.test(e)}function i(e,t,n){var r=this;return r.message=e,r.module=t,n&&(r.stack=n),r}function l(e,t){var n=this;n.url=m.url(t).href,n.regexPattern=new RegExp("^"+o(e)),n.regexUrl=new RegExp("^"+o(t))}function c(){var e=this;e.queue=[],e.current=null}function f(e,t){var n,r=this,a=Promise.defer(),o=new XMLHttpRequest;return m.path.call(r,e,t),r.defered=a,r.promise=a.promise,n=A[r.handler],t||r.promise.then(null,u),n?(o.onreadystatechange=function(){4===o.readyState&&(200===o.status||0===o.status&&o.responseText?(r.value=o.responseText,g.add(r)):a.reject(new i("unable to load module",r.path)))},o.open("GET",r.url+n.suffix,!0),o.send(),setTimeout(function(){o.readyState<4&&o.abort()},5e3)):a.reject(new i('no handler "'+r.handler+'" for',r.path)),r}function p(e,n,r){var a=this,o=Promise.defer();return m.path.call(a,e),a.promise=o.promise,a.promise.then(null,function(e){u(new i("unable to resolve module",a.path,e))}),t.apply(a,r).then(function(){o.resolve(n.apply(null,arguments))},function(e){o.reject(new i("unable to resolve dependencies for",a.path,e))}),a}function h(e,t){var n=v.createElement("script");n.defer=n.async=!0,n.text=t,n.setAttribute("demand-path",e),x.appendChild(n)}function d(e){}var m,g,v=document,y=Array.prototype.slice,w={base:"/"},x=v.getElementsByTagName("head")[0],b=v.createElement("a"),E=/^\//i,j=/^([-\w]+\/[-\w]+)!/,q=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,P=e.demand.main,k=e.demand.settings,T=e.location.host,S={},R={},A={},C={};if(m={url:function(e){return b.href=e,b},path:function(e,t){var n,r,a,u=this,o=e.match(j)||"application/javascript";"string"!=typeof o&&(e=e.replace(o[0],""),o=o[1]),e=(n=s(e))?S.remove(m.url(S.url+e).href):m.url((t&&t.path+"/../"||"/")+e).pathname;for(r in R)R[r].matches(e)&&(a=R[r]);return u instanceof p||u instanceof f?(u.handler=o,u.path=e,u instanceof f&&(u.url=m.url(a?a.process(e):(n?"//"+T:S.url)+e).href),void 0):{handler:o,path:e}}},i.prototype={toString:function(){var e=this,t="[demand] "+e.message+" "+e.module;if(e.stack)for(;e=e.stack;)t+="\n    > "+e.message+" "+e.module;return t}},l.prototype={matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},c.prototype={length:0,add:function(e){var t=this,n=t.queue;n.push(e),t.length++,1===n.length&&t.next()},next:function(){var e=this,t=e.current,n=e.queue;t&&(e.current=null,n.shift(),e.length--),n.length&&(t=e.current=e.queue[0],A[t.handler].callback(t.path,t.value))}},g=new c,a("application/javascript",".js",h),a("text/css",".css",d),r(w)&&k&&r(k),t.configure=r,t.addHandler=a,e.demand=t,e.provide=n,P){var H=v.createElement("script");H.defer=H.async=!0,H.src=P,x.appendChild(H)}e.debug={modules:C,queue:g}}(this);