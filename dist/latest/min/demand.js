/*! Qoopido.js 4.0.0, 2015-08-31 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(e){"use strict";function t(){var e,t,n=this||{},r=n instanceof h?n:null,a=j.call(arguments);return a.forEach(function(e,t){var n=m.path(e,r),a=n.handler,o=n.path,u=M[a]||(M[a]={});this[t]=u[o]||(u[o]=new p(e,r).promise)},a),Promise.all(a).then(function(){"function"==typeof e&&e.apply(null,arguments[0])},function(e){"function"==typeof t&&t(e)}),{then:function(n,r){e=n,t=r}}}function n(){var e,t,n=arguments[0]&&"string"==typeof arguments[0]&&arguments[0]||null,r=!n&&arguments[0]||arguments[1];if(!n&&g.current&&(t=g.current,n=t.handler+"!"+t.path),!n)throw new c("unspecified anonymous provide");return b(function(){var a,o,u,i=m.path(n),s=M[i.handler];if(!t&&s[i.path])throw new c("duplicate found for module",n);a=new h(n,r,e||[]),o=M[a.handler][a.path]=a.promise,t&&(!t.cached&&t.store(),u=t.defered,o.then(function(e){u.resolve(e)},function(e){u.reject(new c("unable to resolve module",n,e))}),g.length>0&&g.next())}),{when:function(){e=j.call(arguments)}}}function r(e){var t,n=e.version,r=e.base,a=e.pattern;if(n&&(d=n),r&&(N=new l(r,m.url(r).href)),a)for(t in a)J[t]=new l(t,a[t])}function a(e,t,n){return L[e]?!1:(L[e]={suffix:t,resolve:n.resolve,modify:n.modify},M[e]={},!0)}function o(e){var t=e instanceof c?"error":"info";"undefined"!=typeof console&&console[t](e.toString())}function u(e){return e.replace(R,"\\$&")}function i(e){return P.test(e)}function s(){}function c(e,t,n){var r=this;return r.message=e,r.module=t,n&&(r.stack=n),r}function l(e,t){var n=this;n.url=m.url(t).href,n.regexPattern=new RegExp("^"+u(e)),n.regexUrl=new RegExp("^"+u(t))}function f(){var e=this;e.queue=[],e.current=null}function p(e,t){var n,r,a=this,u=Promise.defer(),i=new XMLHttpRequest;return m.path.call(a,e,t),a.defered=u,a.promise=u.promise,a.cached=!1,n=L[a.handler],parent||a.promise.then(null,o),n?(r=a.retrieve(),r?g.add(a):(i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status&&i.responseText?(a.source=i.responseText,g.add(a)):u.reject(new c("unable to load module",a.path)))},i.open("GET",a.url+n.suffix,!0),i.send(),b(function(){i.readyState<4&&i.abort()},5e3))):u.reject(new c('no handler "'+a.handler+'" for',a.path)),a}function h(e,n,r){var a=this,u=Promise.defer();return m.path.call(a,e),(a.promise=u.promise).then(null,function(e){o(new c("unable to resolve module",a.path,e))}),t.apply(a,r).then(function(){u.resolve(n.apply(null,arguments))},function(e){u.reject(new c("unable to resolve dependencies for",a.path,e))}),a}var d,m,v,g,y,w,x=document,E=localStorage,b=setTimeout,j=Array.prototype.slice,S=x.getElementsByTagName("head")[0],T=x.createElement("a"),P=/^\//i,q=/^([-\w]+\/[-\w]+)!/,R=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,k=/url\(\s*(?:"|'|)(?!data:|http:|https:|\/)(.+?)(?:"|'|)\)/g,A={version:"1.0.0",base:"/"},C=e.demand.main,H=e.demand.settings,I=e.location.host,N={},J={},L={},M={};if(m={url:function(e){return T.href=e,T},path:function(e,t){var n,r,a,o=this,s=e.match(q)||"application/javascript";"string"!=typeof s&&(e=e.replace(new RegExp("^"+u(s[0])),""),s=s[1]),e=(n=i(e))?N.remove(m.url(N.url+e).href):m.url((t&&t.path+"/../"||"/")+e).pathname;for(r in J)J[r].matches(e)&&(a=J[r]);return o instanceof h||o instanceof p?(o.handler=s,o.path=e,o.version=d,o instanceof p&&(o.url=m.url(a?a.process(e):(n?"//"+I:N.url)+e).href),void 0):{handler:s,path:e,version:d}}},s.prototype={get:function(e,t){var n=JSON.parse(E.getItem(e));return!t||n&&t===n.version?n:void 0},set:function(e,t,n){E.setItem(e,JSON.stringify({version:n||d,source:t}))},clear:function(e){e&&E.removeItem(e)||E.clear()}},c.prototype={toString:function(){var e=this,t="[demand] "+e.message+" "+e.module;if(e.stack)for(;e=e.stack;)t+="\n    > "+e.message+" "+e.module;return t}},l.prototype={matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},f.prototype={length:0,add:function(e){var t=this,n=t.queue;n.push(e),t.length++,1===n.length&&t.next()},next:function(){var e,t=this,n=t.current,r=t.queue;n&&(t.current=null,r.shift(),t.length--),r.length&&(n=t.current=t.queue[0],e=L[n.handler],!n.cached&&e.modify&&(n.source=e.modify(n.url,n.source)),e.resolve(n.path,n.source))}},p.prototype={store:function(){var e=this;v.set(e.path,e.source,e.version)},retrieve:function(){var e=this,t=v.get(e.path,e.version),n=e.cached=!!t;return n&&(e.source=t.source),n}},y={resolve:function(e,t){var n=x.createElement("script");n.type="application/javascript",n.defer=n.async=!0,n.text=t,n.setAttribute("demand-path",e),S.appendChild(n)}},w={resolve:function(e,t){var r=x.createElement("style"),a=r.styleSheet;r.type="text/css",r.media="only x",a&&(a.cssText=t)||(r.innerHTML=t),r.setAttribute("demand-path",e),S.appendChild(r),b(function(){r.media="all",n(function(){return!0})})},modify:function(e,t){for(var n,r=m.url(e+"/..").href;n=k.exec(t);)t=t.replace(n[0],"url("+m.url(r+n[1]).pathname+")");return t}},v=new s,g=new f,a("application/javascript",".js",y),a("text/css",".css",w),r(A)&&H&&r(H),t.configure=r,t.addHandler=a,e.demand=t,e.provide=n,C){var O=x.createElement("script");O.defer=O.async=!0,O.src=C,S.appendChild(O)}}(this);